# Presentation

The [**dOpenSSL**](http://open.infinit.io/dopenssl) library extends the OpenSSL
Project cryptographic library by providing deterministic random generation
functionalities which can be used for rotating and deriving cryptographic keys.

Indeed, the OpenSSL random generator introduces entropy in many places,
making it unusable in a deterministic way. Thus, some functions have been
cloned and adapted in order to guarantee determinism whenever necessary.

This product includes software developed by the OpenSSL Project for use
in the OpenSSL Toolkit. (http://www.openssl.org/)

# Sources

Retrieve the dOpenSSL sources on Github as follows

    $> git clone git://github.com/infinitdotio/dopenssl.git

# Build

First of all, go to the directory containing the dOpenSSL's sources:

    $> cd dopenssl/

Here you will find all the sources, tests and samples related to dOpenSSL.
Then, go to the build directory related to your machine's operating system and
architecture. All the build directories are located in _build/.

For the purpose of this tutorial, we will assume your machine runs a Linux
64-bit operating system.

    $> cd _build/linux64/

There are two ways for building dOpenSSL. The first relies on the
[Drake](http://open.infinit.io/drake) build system with which dOpenSSL has
been developed. The other way consists in invoking a simple Makefile
(generated by Drake).

### Drake

Assuming Drake has been installed on your system and is referenced in the
PYTHONPATH environment variable, simply invoke the //build rule so as to compile
and generate the dOpenSSL library.

    $> ./drake //build
    Compile sources/dopenssl/rand.o
    Compile sources/dopenssl/bn.o
    Compile sources/dopenssl/rsa.o
    Link lib/libdopenssl.a
    Link lib/libdopenssl.so
    $>

Alternatively, one may want to invoke the drake script with a specific python
binary, so as to use the latest python version for instance:

    $> python3.2 ./drake //build

At this point, the dOpenSSL library has been built successfully.

### Make

XXX

# Test

Making sure the dOpenSSL library has been properly built and behaves as expected
on your system is important.

The following assumes your are still in the _build/linux64/ directory.

### Drake

Just invoke the //check rule which will both compile the tests and run them.

    $> ./drake //check
    Compile tests/dopenssl/rsa.o
    Compile tests/dopenssl/rand.o
    Compile tests/dopenssl/bn.o
    Link tests/dopenssl/rsa
    Link tests/dopenssl/rand
    Link tests/dopenssl/bn
    Run tests/dopenssl/rsa
    Run tests/dopenssl/rand
    Run tests/dopenssl/bn
    $>

### Make

XXX

# Install

Installing dOpenSSL on your system is as simple as the previous steps.

### Drake

Invoke the //install rule so as to copy the library files on your system. Note
that the --prefix option can be passed so as to specify the destination
directory.

The example below install the dOpenSSL library in $HOME/local/ with the header
files in $HOME/local/include/ and the library files in $HOME/local/lib/

    $> ./drake //install --prefix=$HOME/local/

### Make

XXX

# Dependencies

The library relies upon several other libraries:

 * OpenSSL which provides the fundamental cryptographic operations.

# Internals

The library is composed of a three components, all required for ensuring the
determinism of the cryptography key generation mechanism.

First, a deterministic random implementation is provided, referred to as dRAND.

Although this implementation is deterministic, determinism must also be assured
at the BIGNUM level because some of the functions introduce entroy, the ones
related to BN_generate_prime_ex() for instance.

Finally a set of functions for deducing a private/public key from a PRNG state
in a deterministic way is provided for every asymmetric cryptosystem, such as
RSA.

In other words, some of the OpenSSL library's functions have been slightly
modified so as to remove the operations destined at adding entropy, especially
the ones based on uninitialized variables.

The reader interested in looking at these slight modifications can look around
for "PATCHED".

# Maintainers

 * Website: http://open.infinit.io
 * Email: contact@open.infinit.io
